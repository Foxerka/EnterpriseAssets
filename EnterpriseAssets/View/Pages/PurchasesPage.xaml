<Page x:Class="EnterpriseAssets.View.Pages.PurchasesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:EnterpriseAssets.View.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1200"
      Title="PurchasesPage"
      Background="#F5F7FA"
      Loaded="Page_Loaded">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 🔹 Заголовок -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="🛒 Закупки оборудования" 
                       FontSize="24" 
                       FontWeight="SemiBold" 
                       Foreground="#2C3E50"
                       Margin="0,0,0,5"/>
            <TextBlock Text="Управление заказами на оборудование у поставщиков" 
                       FontSize="12" 
                       Foreground="#7F8C8D"/>
        </StackPanel>

        <!-- 🔹 Панель управления -->
        <Border Grid.Row="0" 
                VerticalAlignment="Bottom"
                Background="White"
                BorderBrush="#E1E5EB"
                BorderThickness="1"
                CornerRadius="6"
                Padding="12"
                Margin="0,35,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Поиск и фильтры -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox x:Name="TxtSearch" 
                             Width="200"
                             Padding="10,6"
                             TextChanged="TxtSearch_TextChanged"
                             BorderBrush="#BDC3C7"
                             Background="White"
                             VerticalContentAlignment="Center"
                             Margin="0,0,10,0"
                             ToolTip="Поиск по номеру закупки, оборудованию, поставщику"/>

                    <ComboBox x:Name="CmbStatusFilter" 
                              Width="150"
                              Padding="8,4"
                              SelectionChanged="CmbStatusFilter_SelectionChanged"
                              Margin="0,0,10,0">
                        <ComboBoxItem Content="Все статусы" IsSelected="True"/>
                        <ComboBoxItem Content="Черновик"/>
                        <ComboBoxItem Content="На согласовании"/>
                        <ComboBoxItem Content="Согласовано"/>
                        <ComboBoxItem Content="Заказано"/>
                        <ComboBoxItem Content="Доставлено"/>
                        <ComboBoxItem Content="Отменено"/>
                    </ComboBox>

                    <ComboBox x:Name="CmbSupplierFilter" 
                              Width="180"
                              Padding="8,4"
                              SelectionChanged="CmbSupplierFilter_SelectionChanged">
                        <ComboBoxItem Content="Все поставщики" IsSelected="True"/>
                    </ComboBox>
                </StackPanel>

                <!-- Кнопки -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="BtnAddPurchase" 
                            Content="➕ Новая закупка" 
                            Background="#4A6FA5"
                            Foreground="White"
                            Padding="15,8"
                            BorderThickness="0"
                            Cursor="Hand"
                            Margin="0,0,8,0"
                            Click="BtnAddPurchase_Click"/>
                    <Button x:Name="BtnRefresh" 
                            Content="🔄" 
                            ToolTip="Обновить"
                            Background="#95A5A6"
                            Foreground="White"
                            Padding="12,8"
                            BorderThickness="0"
                            Cursor="Hand"
                            Click="BtnRefresh_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 🔹 Список закупок -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="0,0,0,10">
            <ItemsControl x:Name="PurchasesList">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                BorderBrush="#E1E5EB"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="0,0,0,8"
                                Padding="15"
                                Cursor="Hand"
                                MouseLeftButtonUp="PurchaseCard_Click"
                                Tag="{Binding Id}">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="2" BlurRadius="8" Opacity="0.1"/>
                            </Border.Effect>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Индикатор статуса (цветная полоса) -->
                                <Border Grid.Column="0"
                                        Width="10" Height="50"
                                        CornerRadius="5"
                                        Background="{Binding StatusColor}"
                                        Margin="0,0,12,0"
                                        ToolTip="{Binding StatusName}"/>

                                <!-- Основная информация -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <!-- Номер закупки + дата -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                        <TextBlock Text="{Binding PurchaseNumber}" 
                                                   FontSize="16" 
                                                   FontWeight="SemiBold" 
                                                   Foreground="#2C3E50"/>
                                        <TextBlock Text=" | " Foreground="#BDC3C7" Margin="5,0"/>
                                        <TextBlock Text="{Binding OrderDateDisplay}" 
                                                   FontSize="12" 
                                                   Foreground="#95A5A6"/>
                                    </StackPanel>

                                    <!-- Оборудование + поставщик -->
                                    <WrapPanel Margin="0,2,0,0">
                                        <TextBlock Text="🔧" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding EquipmentName}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="12"
                                                   Margin="0,0,12,0"/>

                                        <TextBlock Text="🤝" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding SupplierName}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="12"
                                                   Margin="0,0,12,0"/>
                                    </WrapPanel>

                                    <!-- Менеджер + сроки доставки -->
                                    <WrapPanel Margin="0,4,0,0">
                                        <TextBlock Text="👤" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding ManagerName}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="11"
                                                   Margin="0,0,15,0"/>

                                        <TextBlock Text="📅" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding DeliveryDisplay}" 
                                                   Foreground="{Binding DeliveryColor}" 
                                                   FontSize="11"
                                                   FontWeight="Medium"/>
                                    </WrapPanel>
                                </StackPanel>

                                <!-- Стоимость и количество -->
                                <StackPanel Grid.Column="2" 
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="Right"
                                            Margin="0,0,15,0">
                                    <TextBlock Text="{Binding QuantityDisplay}" 
                                               FontSize="14"
                                               FontWeight="SemiBold"
                                               Foreground="#2C3E50"
                                               HorizontalAlignment="Right"/>
                                    <TextBlock Text="{Binding TotalCostDisplay}" 
                                               FontSize="13"
                                               Foreground="#27AE60"
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Right"/>
                                    <TextBlock Text="{Binding UnitPriceDisplay}" 
                                               FontSize="11"
                                               Foreground="#7F8C8D"
                                               HorizontalAlignment="Right"/>
                                </StackPanel>

                                <!-- Кнопки действий -->
                                <StackPanel Grid.Column="3" 
                                            Orientation="Horizontal"
                                            VerticalAlignment="Center">
                                    <Button Content="👁️" 
                                            ToolTip="Просмотреть"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            FontSize="16"
                                            Margin="4,0"
                                            Click="ViewPurchase_Click"
                                            Tag="{Binding Id}"/>
                                    <Button Content="✏️" 
                                            ToolTip="Редактировать"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            FontSize="16"
                                            Margin="4,0"
                                            Click="EditPurchase_Click"
                                            Tag="{Binding Id}"/>
                                    <Button Content="🗑️" 
                                            ToolTip="Удалить"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            FontSize="16"
                                            Margin="4,0"
                                            Click="DeletePurchase_Click"
                                            Tag="{Binding Id}"
                                            Foreground="#E74C3C"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- 🔹 Статистика -->
        <Border Grid.Row="2" 
                Background="#F8F9FA" 
                Padding="10,8" 
                CornerRadius="4"
                BorderBrush="#E1E5EB"
                BorderThickness="1">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="Всего: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="TotalCount" Text="0" Foreground="#2C3E50" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="💰 Сумма: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="TotalAmount" Text="0 ₽" Foreground="#27AE60" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="⏳ Ожидает: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="PendingCount" Text="0" Foreground="#F39C12" FontWeight="SemiBold" FontSize="12"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>