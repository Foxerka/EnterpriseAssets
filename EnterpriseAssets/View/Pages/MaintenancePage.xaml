<Page x:Class="EnterpriseAssets.View.Pages.MaintenancePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:EnterpriseAssets.View.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1200"
      Title="MaintenancePage"
      Background="#F5F7FA"
      Loaded="Page_Loaded">

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="400"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 🔹 Заголовок и фильтры -->
        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,15">
            <TextBlock Text="🔧 Техническое обслуживание" 
                       FontSize="24" FontWeight="SemiBold" Foreground="#2C3E50"/>
            <TextBlock Text="Мониторинг состояния оборудования и история ТО" 
                       FontSize="12" Foreground="#7F8C8D" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Фильтры -->
        <Border Grid.Row="0" Grid.Column="0" VerticalAlignment="Bottom"
                Background="White" BorderBrush="#E1E5EB" BorderThickness="1"
                CornerRadius="6" Padding="10" Margin="0,35,0,10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🔍 Фильтр:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#7F8C8D"/>
                <ComboBox x:Name="CmbStatusFilter" Width="180" Padding="8,4" 
                          SelectionChanged="CmbStatusFilter_SelectionChanged">
                    <ComboBoxItem Content="Все статусы" IsSelected="True"/>
                    <ComboBoxItem Content="✅ В эксплуатации"/>
                    <ComboBoxItem Content="⚠️ Требует ТО"/>
                    <ComboBoxItem Content="🔧 На обслуживании"/>
                    <ComboBoxItem Content="❌ Неисправен"/>
                </ComboBox>
                <Button Content="🔄 Обновить" Margin="10,0,0,0" Padding="10,4"
                        Background="#95A5A6" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="BtnRefresh_Click"/>
            </StackPanel>
        </Border>

        <!-- 🔹 Список оборудования (слева) -->
        <ScrollViewer Grid.Row="1" Grid.Column="0" 
                      VerticalScrollBarVisibility="Auto" Margin="0,0,10,0">
            <ItemsControl x:Name="EquipmentList">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                CornerRadius="8" Margin="0,0,0,8" Padding="12"
                                Cursor="Hand" MouseLeftButtonUp="EquipmentCard_Click"
                                Tag="{Binding Id}"
                                BorderBrush="{Binding StatusBorderColor}" BorderThickness="2,0,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Информация -->
                                <StackPanel Grid.Column="0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding AssetName}" FontWeight="SemiBold" 
                                                   FontSize="14" Foreground="#2C3E50"/>
                                        <TextBlock Text=" | " Foreground="#BDC3C7"/>
                                        <TextBlock Text="{Binding EquipmentType}" FontSize="12" Foreground="#7F8C8D"/>
                                    </StackPanel>

                                    <WrapPanel Margin="0,4,0,0">
                                        <TextBlock Text="📍" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding Workshop}" FontSize="11" Foreground="#5D6D7E" Margin="0,0,10,0"/>

                                        <TextBlock Text="👤" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding Master}" FontSize="11" Foreground="#5D6D7E" Margin="0,0,10,0"/>
                                    </WrapPanel>

                                    <!-- Статус и ближайшее ТО -->
                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <Border Background="{Binding StatusColor}" CornerRadius="3" 
                                                Padding="6,2" Margin="0,0,10,0">
                                            <TextBlock Text="{Binding StatusName}" FontSize="10" 
                                                       Foreground="White" FontWeight="Medium"/>
                                        </Border>
                                        <TextBlock Text="{Binding NextMaintenanceDisplay}" 
                                                   FontSize="11" Foreground="{Binding MaintenanceColor}" FontWeight="Medium"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Индикатор срочности -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Right">
                                    <TextBlock Text="{Binding UrgencyIcon}" FontSize="20" 
                                               Foreground="{Binding UrgencyColor}"/>
                                    <TextBlock Text="{Binding DaysToMaintenance}" FontSize="10" 
                                               Foreground="#7F8C8D" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- 🔹 Детали и история (справа) -->
        <Border Grid.Row="1" Grid.Column="2" Background="White" BorderBrush="#E1E5EB" 
                BorderThickness="1" CornerRadius="8" Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Заголовок оборудования -->
                <StackPanel Grid.Row="0" Margin="0,0,0,15">
                    <TextBlock x:Name="TxtSelectedAsset" Text="Выберите оборудование" 
                               FontSize="18" FontWeight="SemiBold" Foreground="#2C3E50"/>
                    <TextBlock x:Name="TxtSelectedInfo" Text="" FontSize="12" Foreground="#7F8C8D" Margin="0,5,0,0"/>

                    <!-- Текущий статус крупно -->
                    <Border x:Name="StatusBadge" Background="#95A5A6" CornerRadius="4" 
                            Padding="8,4" Margin="0,10,0,0" HorizontalAlignment="Left">
                        <TextBlock x:Name="TxtCurrentStatus" Text="—" Foreground="White" FontWeight="SemiBold"/>
                    </Border>
                </StackPanel>

                <!-- История ТО -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="📋 История обслуживания" FontWeight="SemiBold" 
                                   FontSize="14" Foreground="#2C3E50" Margin="0,0,0,10"/>

                        <ItemsControl x:Name="MaintenanceHistoryList">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F8F9FA" BorderBrush="#E1E5EB" 
                                            BorderThickness="1" CornerRadius="6" 
                                            Padding="10" Margin="0,0,0,8">
                                        <StackPanel>
                                            <!-- Дата и тип -->
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                                <TextBlock Text="{Binding DateDisplay}" FontWeight="SemiBold" 
                                                           Foreground="#2C3E50" FontSize="12"/>
                                                <TextBlock Text=" • " Foreground="#BDC3C7" Margin="5,0"/>
                                                <TextBlock Text="{Binding Type}" FontSize="12" Foreground="#4A6FA5"/>
                                            </StackPanel>

                                            <!-- Описание -->
                                            <TextBlock Text="{Binding Description}" FontSize="11" 
                                                       Foreground="#5D6D7E" TextWrapping="Wrap" Margin="0,0,0,4"/>

                                            <!-- Детали -->
                                            <WrapPanel Margin="0,2,0,0">
                                                <TextBlock Text="🔧" Foreground="#95A5A6" Margin="0,0,3,0" FontSize="10"/>
                                                <TextBlock Text="{Binding Parts}" FontSize="10" Foreground="#7F8C8D" Margin="0,0,8,0"/>

                                                <TextBlock Text="💰" Foreground="#95A5A6" Margin="0,0,3,0" FontSize="10"/>
                                                <TextBlock Text="{Binding CostDisplay}" FontSize="10" Foreground="#7F8C8D" Margin="0,0,8,0"/>

                                                <TextBlock Text="⏱️" Foreground="#95A5A6" Margin="0,0,3,0" FontSize="10"/>
                                                <TextBlock Text="{Binding DowntimeDisplay}" FontSize="10" Foreground="#7F8C8D"/>
                                            </WrapPanel>

                                            <!-- Следующее ТО -->
                                            <TextBlock Text="{Binding NextMaintenance}" FontSize="10" 
                                                       Foreground="{Binding NextMaintenanceColor}" 
                                                       FontWeight="Medium" Margin="0,4,0,0" FontStyle="Italic"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Если истории нет -->
                        <TextBlock x:Name="TxtNoHistory" Text="История ТО отсутствует" 
                                   Foreground="#95A5A6" FontStyle="Italic" 
                                   HorizontalAlignment="Center" Margin="0,20,0,0"
                                   Visibility="Collapsed"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- 🔹 Статистика -->
        <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                Background="#F8F9FA" Padding="10,8" CornerRadius="4"
                BorderBrush="#E1E5EB" BorderThickness="1">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="Всего: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="TotalCount" Text="0" Foreground="#2C3E50" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="✅ В работе: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="ActiveCount" Text="0" Foreground="#27AE60" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="⚠️ Требует ТО: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="DueCount" Text="0" Foreground="#F39C12" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="❌ Неисправно: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="BrokenCount" Text="0" Foreground="#E74C3C" FontWeight="SemiBold" FontSize="12"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>