<Page x:Class="EnterpriseAssets.View.Pages.EquipmentPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:EnterpriseAssets.View.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1200"
      Title="EquipmentPage"
      Background="#F5F7FA"
      Loaded="Page_Loaded">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 🔹 Заголовок -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="⚙️ Управление оборудованием" 
                       FontSize="24" 
                       FontWeight="SemiBold" 
                       Foreground="#2C3E50"
                       Margin="0,0,0,5"/>
            <TextBlock Text="Оборудование, привязанное к производственным активам" 
                       FontSize="12" 
                       Foreground="#7F8C8D"/>
        </StackPanel>

        <!-- 🔹 Панель управления -->
        <Border Grid.Row="0" 
                VerticalAlignment="Bottom"
                Background="White"
                BorderBrush="#E1E5EB"
                BorderThickness="1"
                CornerRadius="6"
                Padding="12"
                Margin="0,35,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Поиск и фильтры -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox x:Name="TxtSearch" 
                             Width="250"
                             Padding="10,6"
                             TextChanged="TxtSearch_TextChanged"
                             BorderBrush="#BDC3C7"
                             Background="White"
                             VerticalContentAlignment="Center"
                             Margin="0,0,10,0"
                             ToolTip="Поиск по названию, серийному номеру, производителю"/>

                    <ComboBox x:Name="CmbWorkshopFilter" 
                              Width="180"
                              Padding="8,4"
                              SelectionChanged="CmbWorkshopFilter_SelectionChanged"
                              Margin="0,0,10,0">
                        <ComboBoxItem Content="Все цеха" IsSelected="True"/>
                    </ComboBox>

                    <ComboBox x:Name="CmbStatusFilter" 
                              Width="150"
                              Padding="8,4"
                              SelectionChanged="CmbStatusFilter_SelectionChanged">
                        <ComboBoxItem Content="Все статусы" IsSelected="True"/>
                        <ComboBoxItem Content="В эксплуатации"/>
                        <ComboBoxItem Content="На обслуживании"/>
                        <ComboBoxItem Content="Неисправен"/>
                        <ComboBoxItem Content="Списан"/>
                    </ComboBox>
                </StackPanel>

                <!-- Кнопки -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="BtnAddEquipment" 
                            Content="➕ Добавить оборудование" 
                            Background="#4A6FA5"
                            Foreground="White"
                            Padding="15,8"
                            BorderThickness="0"
                            Cursor="Hand"
                            Margin="0,0,8,0"
                            Click="BtnAddEquipment_Click"/>
                    <Button x:Name="BtnRefresh" 
                            Content="🔄" 
                            ToolTip="Обновить"
                            Background="#95A5A6"
                            Foreground="White"
                            Padding="12,8"
                            BorderThickness="0"
                            Cursor="Hand"
                            Click="BtnRefresh_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 🔹 Список оборудования -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="0,0,0,10">
            <ItemsControl x:Name="EquipmentList">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                BorderBrush="#E1E5EB"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="0,0,0,8"
                                Padding="15"
                                Cursor="Hand"
                                MouseLeftButtonUp="EquipmentCard_Click"
                                Tag="{Binding Id}">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="2" BlurRadius="8" Opacity="0.1"/>
                            </Border.Effect>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Статус оборудования (цветной индикатор) -->
                                <Border Grid.Column="0"
                                        Width="12" Height="40"
                                        CornerRadius="6"
                                        Background="{Binding StatusColor}"
                                        Margin="0,0,12,0"
                                        ToolTip="{Binding StatusName}"/>

                                <!-- Основная информация -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <!-- Название + серийный номер -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                        <TextBlock Text="{Binding AssetName}" 
                                                   FontSize="16" 
                                                   FontWeight="SemiBold" 
                                                   Foreground="#2C3E50"/>
                                        <TextBlock Text=" | " Foreground="#BDC3C7" Margin="5,0"/>
                                        <TextBlock Text="{Binding AssetId}" 
                                                   FontSize="12" 
                                                   Foreground="#95A5A6"
                                                   FontStyle="Italic"/>
                                    </StackPanel>

                                    <!-- Тип + производитель -->
                                    <WrapPanel Margin="0,2,0,0">
                                        <TextBlock Text="🔧" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding EquipmentType}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="12"
                                                   Margin="0,0,12,0"/>

                                        <TextBlock Text="🏭" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding Manufacturer}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="12"
                                                   Margin="0,0,12,0"/>
                                    </WrapPanel>

                                    <!-- Цех + мастер + даты -->
                                    <WrapPanel Margin="0,4,0,0">
                                        <TextBlock Text="📍" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding WorkshopName}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="11"
                                                   Margin="0,0,15,0"/>

                                        <TextBlock Text="👤" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding MasterName}" 
                                                   Foreground="#5D6D7E" 
                                                   FontSize="11"
                                                   Margin="0,0,15,0"/>

                                        <TextBlock Text="📅" Foreground="#95A5A6" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding NextMaintenanceDisplay}" 
                                                   Foreground="{Binding MaintenanceColor}" 
                                                   FontSize="11"
                                                   FontWeight="Medium"/>
                                    </WrapPanel>

                                    <!-- Наработка -->
                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <TextBlock Text="⏱️ Наработка: " FontSize="11" Foreground="#95A5A6"/>
                                        <TextBlock Text="{Binding WorkHoursDisplay}" 
                                                   FontSize="11" 
                                                   FontWeight="SemiBold"
                                                   Foreground="#2C3E50"/>
                                        <TextBlock Text=" / " FontSize="11" Foreground="#BDC3C7"/>
                                        <TextBlock Text="{Binding MaxHoursDisplay}" 
                                                   FontSize="11" 
                                                   Foreground="#7F8C8D"/>

                                        <!-- Прогресс-бар наработки -->
                                        <ProgressBar x:Name="HoursProgress"
                                                     Width="100" Height="6"
                                                     Margin="10,0,0,0"
                                                     Minimum="0" Maximum="100"
                                                     Value="{Binding WorkHoursPercent}"
                                                     Foreground="#4A6FA5"
                                                     Background="#ECF0F1"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Гарантия и статус -->
                                <StackPanel Grid.Column="2" 
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="Right"
                                            Margin="0,0,15,0">
                                    <TextBlock Text="{Binding WarrantyDisplay}" 
                                               FontSize="12"
                                               FontWeight="Medium"
                                               Foreground="{Binding WarrantyColor}"
                                               HorizontalAlignment="Right"/>
                                    <TextBlock Text="{Binding StatusName}" 
                                               FontSize="11"
                                               Foreground="{Binding StatusColor}"
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Right"
                                               Margin="0,4,0,0"/>
                                </StackPanel>

                                <!-- Кнопки действий -->
                                <StackPanel Grid.Column="3" 
                                            Orientation="Horizontal"
                                            VerticalAlignment="Center">
                                    <Button Content="✏️" 
                                            ToolTip="Редактировать"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            FontSize="16"
                                            Margin="4,0"
                                            Click="EditEquipment_Click"
                                            Tag="{Binding Id}"/>
                                    <Button Content="🗑️" 
                                            ToolTip="Удалить"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            FontSize="16"
                                            Margin="4,0"
                                            Click="DeleteEquipment_Click"
                                            Tag="{Binding Id}"
                                            Foreground="#E74C3C"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- 🔹 Статистика -->
        <Border Grid.Row="2" 
                Background="#F8F9FA" 
                Padding="10,8" 
                CornerRadius="4"
                BorderBrush="#E1E5EB"
                BorderThickness="1">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="Всего: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="TotalCount" Text="0" Foreground="#2C3E50" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="✅ В работе: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="ActiveCount" Text="0" Foreground="#27AE60" FontWeight="SemiBold" FontSize="12" Margin="0,0,15,0"/>
                <TextBlock Text="⚠️ Требует ТО: " Foreground="#7F8C8D" FontSize="12"/>
                <TextBlock x:Name="MaintenanceCount" Text="0" Foreground="#E67E22" FontWeight="SemiBold" FontSize="12"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>